<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Magnetite.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Magnetite.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">64.76% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>68/105</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">44.74% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>17/38</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">75% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>9/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">65.09% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>69/106</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-yes">25×</span>
<span class="cline-any cline-yes">25×</span>
<span class="cline-any cline-yes">25×</span>
<span class="cline-any cline-yes">25×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">32×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-yes">28×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: GPL-3.0-or-later
pragma solidity ^0.8.4;
&nbsp;
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/access/IAccessControl.sol";
import "./libs/IUniPair.sol";
import "./libs/IUniRouter.sol";
import "./libs/IUniFactory.sol";
import "./libs/IMagnetite.sol";
&nbsp;
//Automatically generates and stores paths
contract Magnetite is Ownable, IMagnetite {
&nbsp;
    struct PairData {
        IERC20 token;
        IUniPair lp;
        uint liquidity;
    }
    
    bytes constant private COMMON_TOKENS = abi.encode([
        address(0), //slot for wnative
        0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174, //usdc
        0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619, //weth
        0x831753DD7087CaC61aB5644b308642cc1c33Dc13, //quick
        0xc2132D05D31c914a87C6611C10748AEb04B58e8F, //usdt
        0x8f3Cf7ad23Cd3CaDbD9735AFf958023239c6A063  //dai
    ]);
&nbsp;
    uint constant private NUM_COMMON = 6;
    uint constant private WNATIVE_MULTIPLIER = 3; // Wnative weighted 3x
    uint constant private B_MULTIPLIER = 10; // Token B direct swap weighted 10x
&nbsp;
    enum AutoPath { MANUAL, SUBPATH, AUTO }
    event SetPath(AutoPath indexed _auto, address router, IERC20[] path);
&nbsp;
    mapping(bytes32 =&gt; IERC20[]) private _paths;
&nbsp;
    //Adds or modifies a swap path
<span class="fstat-no" title="function not covered" >    function overridePath(address router, IERC20[] calldata _path) external {</span>
<span class="cstat-no" title="statement not covered" >        require(IAccessControl(owner()).hasRole(keccak256("PATH_SETTER"), msg.sender), "!auth")</span>;
<span class="cstat-no" title="statement not covered" >        _setPath(router, _path, AutoPath.MANUAL)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setAutoPath_(address router, IERC20[] calldata _path) internal {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == address(this))</span>;
<span class="cstat-no" title="statement not covered" >        _setPath(router, _path, AutoPath.AUTO)</span>;
    }
    function findAndSavePath(address _router, IERC20 a, IERC20 b) external returns (IERC20[] memory path) {
        IUniRouter router = IUniRouter(_router);
        path = getPathFromStorage(_router, a, b); // [A C E D B]
&nbsp;
        if (path.length == 0) {
&nbsp;
            path = generatePath(router, a, b);
            <span class="missing-if-branch" title="else path not taken" >E</span>if (pathAuth()) {
                _setPath(_router, path, AutoPath.AUTO);
            }
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function viewPath(address _router, IERC20 a, IERC20 b) external view returns (IERC20[] memory path) {</span>
<span class="cstat-no" title="statement not covered" >        IUniRouter router = IUniRouter(_router);</span>
<span class="cstat-no" title="statement not covered" >        path = getPathFromStorage(_router, a, b)</span>; // [A C E D B]
<span class="cstat-no" title="statement not covered" >        if (path.length == 0) {</span>
<span class="cstat-no" title="statement not covered" >            path = generatePath(router, a, b)</span>;
        }
    }
    function getPathFromStorage(address router, IERC20 a, IERC20 b) public view returns (IERC20[] memory path) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (a == b) {
<span class="cstat-no" title="statement not covered" >            path = new IERC20[](1)</span>;
<span class="cstat-no" title="statement not covered" >            path[0] = a</span>;
<span class="cstat-no" title="statement not covered" >            return path;</span>
        }
        path = _paths[keccak256(abi.encodePacked(router, a, b))];
    }
&nbsp;
    function pathAuth() internal virtual view returns (bool) {
        return msg.sender == tx.origin || msg.sender == owner() || IAccessControl(owner()).hasRole(keccak256("STRATEGY"), msg.sender);
    }
&nbsp;
    function _setPath(address router, IERC20[] memory _path, AutoPath _auto) internal { 
        uint len = _path.length;
&nbsp;
        bytes32 hashAB = keccak256(abi.encodePacked(router,_path[0], _path[len - 1]));
        bytes32 hashBA = keccak256(abi.encodePacked(router,_path[len - 1], _path[0]));
        IERC20[] storage pathAB = _paths[hashAB];
        if (pathAB.length &gt; 0 &amp;&amp; _auto != AutoPath.MANUAL) return;
        IERC20[] storage pathBA = _paths[hashBA];
        
        for (uint i; i &lt; len; i++) {
            pathAB.push() = _path[i];
            pathBA.push() = _path[len - i - 1];
        }
            
        emit SetPath(_auto, router, pathAB);
        emit SetPath(_auto, router, pathBA);
        
        //fill sub-paths
        if (len &gt; 2) {
            assembly { 
                mstore(_path, sub(len,1)) //reduce length by 1 (_we want _path[:len-1])
            } 
            _setPath(router, _path, AutoPath.SUBPATH);
            IERC20 path0 = _path[0]; //temp to restore array after slicing
            assembly {
                _path := add(0x20,_path) // shift right in memory (we want _path[1:])
                mstore(_path, sub(len,1))
            }
            _setPath(router, _path, AutoPath.SUBPATH);
            assembly {
                mstore(_path, path0) //restore path[0]
                _path := sub(_path,0x20) //shift to initial start
                mstore(_path, len) //correct length
            }
        }
    }
    
    function generatePath(IUniRouter router, IERC20 a, IERC20 b) internal view returns (IERC20[] memory path) {
    
        IERC20[] memory _b = new IERC20[](2);
        _b[0] = b;
        IERC20 c = findPair(router, a, _b);
        _b[0] = a;
        IERC20 d = findPair(router, b, _b);
        
        path = new IERC20[](5);
        path[0] = a;
        
        if (c == b || d == a) {
            path[1] = b;
            return path;
        } else <span class="missing-if-branch" title="else path not taken" >E</span>if (c == d) {
            path[1] = c;
            path[2] = b;
            return setlength(path, 3);
        }
<span class="cstat-no" title="statement not covered" >        _b[1] = c</span>;
<span class="cstat-no" title="statement not covered" >        IERC20 e0 = findPair(router, d, _b);</span>
<span class="cstat-no" title="statement not covered" >        if (e0 == a) {</span>
<span class="cstat-no" title="statement not covered" >            path[1] = d</span>;
<span class="cstat-no" title="statement not covered" >            path[2] = b</span>;
<span class="cstat-no" title="statement not covered" >            return setlength(path, 3);</span>
        }
<span class="cstat-no" title="statement not covered" >        path[1] = c</span>;
<span class="cstat-no" title="statement not covered" >        if (e0 == c) {</span>
<span class="cstat-no" title="statement not covered" >            path[2] = d</span>;
<span class="cstat-no" title="statement not covered" >            path[3] = b</span>;
<span class="cstat-no" title="statement not covered" >            return setlength(path, 4);</span>
        }
<span class="cstat-no" title="statement not covered" >        _b[0] = b</span>;
<span class="cstat-no" title="statement not covered" >        _b[1] = d</span>;
<span class="cstat-no" title="statement not covered" >        IERC20 e1 = findPair(router, c, _b);</span>
<span class="cstat-no" title="statement not covered" >        if (e1 == b) {</span>
<span class="cstat-no" title="statement not covered" >            path[2] = b</span>;
<span class="cstat-no" title="statement not covered" >            return setlength(path, 3);</span>
        }
<span class="cstat-no" title="statement not covered" >        if (e1 == d) {</span>
<span class="cstat-no" title="statement not covered" >            path[2] = d</span>;
<span class="cstat-no" title="statement not covered" >            path[3] = b</span>;
<span class="cstat-no" title="statement not covered" >            return setlength(path, 4);</span>
        }
<span class="cstat-no" title="statement not covered" >        require (e1 == e0, "no path found")</span>;
<span class="cstat-no" title="statement not covered" >        path[2] = e0</span>;
<span class="cstat-no" title="statement not covered" >        path[3] = d</span>;
<span class="cstat-no" title="statement not covered" >        path[4] = b</span>;
<span class="cstat-no" title="statement not covered" >        return path;</span>
    }   
    function findPair(IUniRouter router, IERC20 a, IERC20[] memory b) internal view returns (IERC20) {
        IUniFactory factory = IUniFactory(router.factory());
        
        PairData[] memory pairData = new PairData[](NUM_COMMON + b.length);
&nbsp;
        IERC20[NUM_COMMON] memory allCom = allCommons(router);
        
        //populate pair tokens
        for (uint i; i &lt; b.length; i++) {
            pairData[i].token = b[i];   
        }
        for (uint i; i &lt; NUM_COMMON; i++) {
            pairData[i+b.length].token = allCom[i];
        }
        
        //calculate liquidity
        for (uint i; i &lt; pairData.length; i++) {
            IUniPair pair = factory.getPair(a, pairData[i].token);
            if (address(pair) != address(0)) {
                uint liq = a.balanceOf(address(pair));
                <span class="missing-if-branch" title="else path not taken" >E</span>if (liq &gt; 0) {
                    pairData[i].lp = pair;
                    pairData[i].liquidity = liq;
                }
            }
        }
        //find weighted most liquid pair
        for (uint i; i &lt; pairData.length; i++) {
            pairData[i].liquidity = pairData[i].liquidity * B_MULTIPLIER;
        }
        uint best;
        for (uint i = 1; i &lt; pairData.length; i++) {
            if (compare(router, pairData[best], pairData[i])) best = i;
        }
        <span class="missing-if-branch" title="else path not taken" >E</span>require(pairData[best].liquidity &gt; 0, "no liquidity");
        
        return pairData[best].token;
    }
    
    function compare(IUniRouter router, PairData memory x, PairData memory y) private pure returns (bool yBetter) {
        IERC20 wNative = router.WETH();
        uint xLiquidity = x.liquidity * (x.token == wNative ? WNATIVE_MULTIPLIER : 1);
        uint yLiquidity = y.liquidity * (y.token == wNative ? WNATIVE_MULTIPLIER : 1);
        return yLiquidity &gt; xLiquidity;
    }
&nbsp;
    function allCommons(IUniRouter router) private pure returns (IERC20[NUM_COMMON] memory tokens) {
        tokens = abi.decode(COMMON_TOKENS,(IERC20[6]));
        tokens[0] = router.WETH();
    }
    function setlength(IERC20[] memory array, uint n) internal pure returns (IERC20[] memory) {
        assembly { mstore(array, n) }
        return array;
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Feb 04 2022 13:38:08 GMT+0200 (South Africa Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
